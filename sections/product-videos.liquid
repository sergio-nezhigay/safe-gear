{{ 'section-product-videos.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign spacing_style = 'padding-block-start: ' | append: section.settings['padding-block-start'] | append: 'px; padding-block-end: ' | append: section.settings['padding-block-end'] | append: 'px;'
-%}

<div class="product-videos" style="{{ spacing_style }}">
  <div class="product-videos__container content-width-{{ section.settings.content_width }}">
    {%- if section.settings.heading != blank -%}
      <h2 class="product-videos__heading {{ section.settings.heading_size }}">
        {{ section.settings.heading }}
      </h2>
    {%- endif -%}

    {%- if section.blocks.size > 0 -%}
      <div class="product-videos__grid">
        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- when 'video_item' -%}
              <div class="product-videos__item" {{ block.shopify_attributes }}>
                {%- liquid
                  assign video_source = block.settings.video_source
                  assign video_id = block.settings.video_id
                  assign video_url = block.settings.video_url
                  assign shopify_video = block.settings.shopify_video
                  assign cover_image = block.settings.cover_image
                  assign autoplay = block.settings.autoplay
                  assign loop = block.settings.loop
                -%}

                {%- case video_source -%}
                  {%- when 'shopify' -%}
                    {%- if shopify_video != blank -%}
                      {%- render 'video',
                        video: shopify_video,
                        video_autoplay: autoplay,
                        video_loop: loop,
                        video_preview_image: cover_image,
                        section_id: section.id,
                        block: block,
                        video_class: 'product-videos__video'
                      -%}
                    {%- else -%}
                      <div class="product-videos__placeholder">
                        {{ 'hero-apparel-3' | placeholder_svg_tag }}
                      </div>
                    {%- endif -%}

                  {%- when 'youtube' -%}
                    {%- if video_id != blank -%}
                      {%- render 'video',
                        video: video_id,
                        video_from_url: true,
                        video_type: 'youtube',
                        video_autoplay: autoplay,
                        video_loop: loop,
                        video_preview_image: cover_image,
                        section_id: section.id,
                        block: block,
                        video_class: 'product-videos__video'
                      -%}
                    {%- else -%}
                      <div class="product-videos__placeholder">
                        {{ 'hero-apparel-3' | placeholder_svg_tag }}
                      </div>
                    {%- endif -%}

                  {%- when 'vimeo' -%}
                    {%- if video_id != blank -%}
                      {%- render 'video',
                        video: video_id,
                        video_from_url: true,
                        video_type: 'vimeo',
                        video_autoplay: autoplay,
                        video_loop: loop,
                        video_preview_image: cover_image,
                        section_id: section.id,
                        block: block,
                        video_class: 'product-videos__video'
                      -%}
                    {%- else -%}
                      <div class="product-videos__placeholder">
                        {{ 'hero-apparel-3' | placeholder_svg_tag }}
                      </div>
                    {%- endif -%}

                  {%- when 'external' -%}
                    {%- if video_url != blank -%}
                      <deferred-media class="product-videos__video">
                        {%- if cover_image != blank -%}
                          <button
                            class="button deferred-media__poster-button button-unstyled"
                            ref="deferredMediaPlayButton"
                            aria-label="{{ 'accessibility.play_video' | t }}"
                            type="button"
                            on:click="/showDeferredMedia"
                          >
                            {{
                              cover_image
                              | image_url: width: 3840
                              | image_tag: class: 'deferred-media__poster-image', loading: 'lazy'
                            }}
                            <span class="deferred-media__poster-icon icon-play">
                              <span class="visually-hidden">{{ 'accessibility.play_video' | t }}</span>
                              {{- 'icon-play.svg' | inline_asset_content -}}
                            </span>
                          </button>
                        {%- endif -%}
                        <template>
                          <video
                            controls
                            {% if autoplay %}autoplay muted{% endif %}
                            {% if loop %}loop{% endif %}
                          >
                            <source src="{{ video_url }}" type="video/mp4">
                          </video>
                        </template>
                      </deferred-media>
                    {%- else -%}
                      <div class="product-videos__placeholder">
                        {{ 'hero-apparel-3' | placeholder_svg_tag }}
                      </div>
                    {%- endif -%}
                {%- endcase -%}
              </div>
          {%- endcase -%}
        {%- endfor -%}
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Product Videos",
  "tag": "section",
  "class": "section-product-videos",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Videos"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "options": [
        {
          "value": "h6",
          "label": "Extra Small"
        },
        {
          "value": "h5",
          "label": "Small"
        },
        {
          "value": "h4",
          "label": "Medium"
        },
        {
          "value": "h3",
          "label": "Large"
        },
        {
          "value": "h2",
          "label": "Extra Large"
        }
      ],
      "default": "h3"
    },
    {
      "type": "select",
      "id": "content_width",
      "label": "Content width",
      "options": [
        {
          "value": "narrow",
          "label": "Narrow"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "wide",
          "label": "Wide"
        }
      ],
      "default": "medium"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 60
    }
  ],
  "blocks": [
    {
      "type": "video_item",
      "name": "Video",
      "settings": [
        {
          "type": "select",
          "id": "video_source",
          "label": "Video source",
          "options": [
            {
              "value": "shopify",
              "label": "Shopify-hosted video"
            },
            {
              "value": "youtube",
              "label": "YouTube"
            },
            {
              "value": "vimeo",
              "label": "Vimeo"
            },
            {
              "value": "external",
              "label": "External URL (MP4)"
            }
          ],
          "default": "youtube",
          "info": "Select the type of video source"
        },
        {
          "type": "video",
          "id": "shopify_video",
          "label": "Shopify video",
          "info": "Upload a video file (only used if 'Shopify-hosted video' is selected)"
        },
        {
          "type": "text",
          "id": "video_id",
          "label": "Video ID",
          "info": "YouTube: The video ID (e.g., 'dQw4w9WgXcQ' from youtube.com/watch?v=dQw4w9WgXcQ). Vimeo: The video ID (e.g., '76979871' from vimeo.com/76979871)"
        },
        {
          "type": "url",
          "id": "video_url",
          "label": "Video URL",
          "info": "Direct link to MP4 file (only used if 'External URL' is selected)"
        },
        {
          "type": "image_picker",
          "id": "cover_image",
          "label": "Cover image",
          "info": "Thumbnail image shown before video plays"
        },
        {
          "type": "checkbox",
          "id": "autoplay",
          "label": "Autoplay video",
          "default": false,
          "info": "Video will be muted if autoplay is enabled"
        },
        {
          "type": "checkbox",
          "id": "loop",
          "label": "Loop video",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Videos",
      "blocks": [
        {
          "type": "video_item"
        }
      ]
    }
  ]
}
{% endschema %}
