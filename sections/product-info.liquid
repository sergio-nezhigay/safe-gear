<script
  src="{{ 'product-info.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<product-info-section
  class="
    product-info-section
    section
    section--{{ section.settings.section_width | default: 'page-width' }}
    color-{{ section.settings.color_scheme }}
    spacing-style
  "
  style="{% render 'spacing-style', settings: section.settings %}"
  data-section-id="{{ section.id }}"
  data-lazy-load="{{ section.settings.enable_lazy_loading | default: true }}"
  role="region"
  aria-labelledby="product-info-heading-{{ section.id }}"
  {{ section.shopify_attributes }}
>
  <h2 id="product-info-heading-{{ section.id }}" class="sr-only">
    Product Information
  </h2>

  <div class="product-info__skeleton" data-skeleton aria-hidden="true">
    {% for i in (1..3) %}
      <div class="skeleton-table">
        <div class="skeleton-header"></div>
        <div class="skeleton-rows">
          {% for j in (1..5) %}
            <div class="skeleton-row">
              <div class="skeleton-cell skeleton-cell--label"></div>
              <div class="skeleton-cell skeleton-cell--value"></div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>

  {% if product.metafields.custom.new_height != blank
    or product.metafields.custom.new_width != blank
    or product.metafields.custom.new_depth != blank
    or product.metafields.custom.new_height_interior != blank
    or product.metafields.custom.new_width_interior != blank
    or product.metafields.custom.new_depth_interior != blank
    or product.metafields.custom.custom_range != blank
    or product.metafields.custom.door_opening_height != blank
    or product.metafields.custom.door_opening_angle != blank
    or product.metafields.custom.width_door_open_180 != blank
    or product.metafields.custom.depth_door_open_90 != blank
    or product.metafields.custom.model != blank
    or product.metafields.custom.model_series != blank
    or product.metafields.custom.safe_kind != blank
    or product.metafields.custom.safe_purpose != blank
    or product.metafields.custom.door_structure != blank
    or product.metafields.custom.body_structure != blank
    or product.metafields.custom.bolting != blank
    or product.metafields.custom.bolts_included != blank
    or product.metafields.custom.burglary_classification != blank
    or product.metafields.custom.burglary_test_method != blank
    or product.metafields.custom.burglary_test_center != blank
    or product.metafields.custom.cash_rating != blank
    or product.metafields.custom.fire_duration != blank
  %}
    <h3 class="product-info__main-title h4">
      Produktoplysninger
    </h3>
  {% endif %}

  <div class="product-info__content" data-content>
    {% assign dimensions_blocks = section.blocks | where: 'type', 'dimensions_row' %}
    {% if dimensions_blocks.size > 0 %}
      <div class="table-container">
        <table class="product-table">
          <thead>
            <tr>
              <th colspan="2" class="table-header">{{ section.settings.section_heading }}</th>
            </tr>
          </thead>
          <tbody>
            {% for block in dimensions_blocks %}
              {% if block.settings.value != blank %}
                <tr {{ block.shopify_attributes }}>
                  <td><strong>{{ block.settings.label }}</strong></td>
                  <td>{{ block.settings.value }}</td>
                </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}

    {% assign features_blocks = section.blocks | where: 'type', 'features_row' %}
    {% if features_blocks.size > 0 %}
      <div class="table-container">
        <table class="product-table">
          <thead>
            <tr>
              <th colspan="2" class="table-header">{{ section.settings.key_features }}</th>
            </tr>
          </thead>
          <tbody>
            {% for block in features_blocks %}
              {% if block.settings.value != blank %}
                <tr {{ block.shopify_attributes }}>
                  <td><strong>{{ block.settings.label }}</strong></td>
                  <td>{{ block.settings.value }}</td>
                </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}

    {% assign security_blocks = section.blocks | where: 'type', 'security_row' %}
    {% if security_blocks.size > 0 %}
      <div class="table-container">
        <table class="product-table">
          <thead>
            <tr>
              <th colspan="2" class="table-header">{{ section.settings.burglary_protection }}</th>
            </tr>
          </thead>
          <tbody>
            {% for block in security_blocks %}
              {% if block.settings.value != blank %}
                <tr {{ block.shopify_attributes }}>
                  <td><strong>{{ block.settings.label }}</strong></td>
                  <td>{{ block.settings.value }}</td>
                </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>
</product-info-section>

{% stylesheet %}
  .product-info-section {
    --section-padding: var(--spacing-md, 16px);
    --table-border-radius: 12px;
    --table-gap: var(--spacing-lg, 24px);
    --table-header-bg: #cbe3ff;
    --table-row-even-bg: #f8fafc;
    --table-row-odd-bg: #ffffff;
    --table-border-color: #e2e8f0;
    --skeleton-opacity: 0.1;
    padding: clamp(24px, 5vw, 48px) 0;
  }

  @media (min-width: 990px) {
    .product-info-section {
      --table-gap: clamp(32px, 4vw, 48px);
      padding: clamp(48px, 6vw, 72px) 0;
    }
  }

  .product-info__content {
    max-width: 1200px;
    margin: 0 auto;
    display: block;
  }

  .table-container {
    width: 100%;
    margin-bottom: 24px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }

  .product-table {
    width: 100%;
    border-collapse: collapse;
  }

  .table-header {
    background: #f0f8ff;
    color: #333;
    padding: 16px;
    font-weight: bold;
    font-size: 16px;
    text-align: left;
  }

  .product-table td,
  .product-table th {
    padding: 12px 16px;
    text-align: left;
    border-bottom: 1px solid #eee;
  }

  .product-table td:first-child,
  .product-table th:first-child {
    width: 40%;
    font-weight: 600;
  }

  .product-table tr:nth-child(even) {
    background: #fafafa;
  }

  .product-table tr:last-child td {
    border-bottom: none;
  }

  .product-info__main-title {
    font-family: var(--font-primary--family);
    font-size: var(--font-h4--size);
    font-weight: var(--font-h4--weight);
    color: var(--font-h4--color);
    line-height: var(--font-h4--line-height);
    text-align: left;
    margin-bottom: clamp(24px, 4vw, 48px);
  }

  /* Skeleton Loading States */
  .product-info__skeleton {
    display: grid;
    gap: var(--table-gap);
    grid-template-columns: 1fr;
  }

  @media (min-width: 990px) {
    .product-info__skeleton {
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    }
  }

  .skeleton-table {
    border-radius: var(--table-border-radius);
    overflow: hidden;
    background: white;
  }

  .skeleton-header {
    height: 48px;
    background-color: var(--table-header-bg);
    opacity: var(--skeleton-opacity);
    animation: skeleton-loading 1.5s infinite ease-in-out;
  }

  .skeleton-row {
    display: grid;
    grid-template-columns: 30% 1fr;
    gap: 12px;
    padding: 12px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  }

  .skeleton-row:nth-child(even) {
    background-color: var(--table-row-even-bg);
  }

  .skeleton-cell {
    height: 16px;
    background-color: var(--color-foreground, #000);
    opacity: var(--skeleton-opacity);
    border-radius: 2px;
    animation: skeleton-loading 1.5s infinite ease-in-out;
  }

  .skeleton-cell--label {
    animation-delay: 0.1s;
  }

  .skeleton-cell--value {
    animation-delay: 0.2s;
  }

  @keyframes skeleton-loading {
    0%,
    100% {
      opacity: var(--skeleton-opacity);
    }
    50% {
      opacity: calc(var(--skeleton-opacity) * 2);
    }
  }

  /* Hide skeleton when content is loaded */
  product-info-section[data-loaded] .product-info__skeleton {
    display: none;
  }

  /* Initially hide content until loaded */
  .product-info__content {
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  product-info-section[data-loaded] .product-info__content {
    opacity: 1;
  }

  /* Mobile Responsive */
  @media screen and (max-width: 600px) {
    .dimensions-table td:first-child,
    table.key-features-table td:first-child {
      width: 36%;
    }

    .dimensions-table-container {
      padding: 0;
    }

    .dimensions-table td,
    .key-features-table td {
      font-size: 14px;
    }

    .table-heading {
      font-size: 18px;
    }

    .product-info__content {
      gap: var(--spacing-md, 16px);
    }
  }

  /* Performance optimizations */
  .product-info-section {
    contain: layout;
  }

  .dimensions-table-container,
  .key-features-table-container,
  .table-container {
    will-change: auto;
  }

  /* Accessibility improvements */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Product Info",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "blocks": [
    {
      "type": "dimensions_row",
      "name": "Dimensions Row",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Dimension"
        },
        {
          "type": "text",
          "id": "value",
          "label": "Value",
          "info": "Connect to metafield using dynamic sources"
        }
      ]
    },
    {
      "type": "features_row",
      "name": "Features Row",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Feature"
        },
        {
          "type": "text",
          "id": "value",
          "label": "Value",
          "info": "Connect to metafield using dynamic sources"
        }
      ]
    },
    {
      "type": "security_row",
      "name": "Security Row",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Security Feature"
        },
        {
          "type": "text",
          "id": "value",
          "label": "Value",
          "info": "Connect to metafield using dynamic sources"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "header",
      "content": "Section Layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Width",
      "options": [
        {
          "value": "page-width",
          "label": "Page"
        },
        {
          "value": "full-width",
          "label": "Full"
        }
      ],
      "default": "page-width"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "checkbox",
      "id": "enable_lazy_loading",
      "label": "Enable lazy loading",
      "info": "Improves page performance by loading content only when visible",
      "default": true
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 48
    },
    {
      "type": "header",
      "content": "Table Headers"
    },
    {
      "type": "inline_richtext",
      "id": "section_heading",
      "label": "Dimensions Table Heading",
      "default": "Dimensions"
    },
    {
      "type": "inline_richtext",
      "id": "key_features",
      "label": "Key Features Table Heading",
      "default": "Key Features"
    },
    {
      "type": "inline_richtext",
      "id": "burglary_protection",
      "label": "Security Table Heading",
      "default": "Security & Protection"
    }
  ],
  "presets": [
    {
      "name": "Product Info",
      "category": "Product",
      "settings": {
        "section_width": "page-width",
        "color_scheme": "scheme-1",
        "enable_lazy_loading": true,
        "padding-block-start": 48,
        "padding-block-end": 48,
        "section_heading": "Dimensions",
        "key_features": "Key Features",
        "burglary_protection": "Security & Protection"
      },
      "blocks": [
        {
          "type": "dimensions_row",
          "settings": {
            "label": "Height",
            "value": "{{ product.metafields.custom.new_height }}"
          }
        },
        {
          "type": "dimensions_row",
          "settings": {
            "label": "Width",
            "value": "{{ product.metafields.custom.new_width }}"
          }
        },
        {
          "type": "dimensions_row",
          "settings": {
            "label": "Depth",
            "value": "{{ product.metafields.custom.new_depth }}"
          }
        },
        {
          "type": "features_row",
          "settings": {
            "label": "Model",
            "value": "{{ product.metafields.custom.model }}"
          }
        },
        {
          "type": "features_row",
          "settings": {
            "label": "Product Name",
            "value": "{{ product.title }}"
          }
        },
        {
          "type": "security_row",
          "settings": {
            "label": "Classification",
            "value": "{{ product.metafields.custom.burglary_classification }}"
          }
        }
      ]
    }
  ]
}
{% endschema %}
