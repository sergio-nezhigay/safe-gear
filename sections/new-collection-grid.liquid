{% liquid
    assign current_collection = collection
    assign show_more_text = section.settings.show_more_text
    assign hidden_text = section.settings.hidden_text
    
    assign burglary_grade = current_collection.metafields.custom.burglary_grade.value
    assign fire_resistance = current_collection.metafields.custom.fire_resistance.value
  %}
  
  {{ 'collection-header.css' | asset_url | stylesheet_tag }}
  
  <section class="collection-header-section" data-section-id="{{ section.id }}">
    <div class="container">
      <header class="collection-header">
        <h1 class="collection-header__title">
          {% if current_collection.title != blank %}
            {{ current_collection.title | escape }}
          {% else %}
            {{ section.settings.title | escape }}
          {% endif %}
        </h1>
        
        <div class="collection-header__description">
          {% if current_collection.description != blank %}
            {{ current_collection.description }}
          {% else %}
            {{ section.settings.description }}
          {% endif %}
        </div>
  
        {% if burglary_grade != blank or fire_resistance != blank or section.blocks.size > 0 %}
          <div class="collection-header__features">
            {% comment %} Auto-generated Burglary Resistance feature {% endcomment %}
            {% if burglary_grade != blank %}
              <div class="feature-item feature-item--auto">
                <div class="feature-item__icon">
                  {% case burglary_grade %}
                    {% when 'S1' %}
                      {% if settings.icon_burglary_s1 != blank %}
                        <img src="{{ settings.icon_burglary_s1 | image_url: width: 48 }}" alt="S1 Grade" width="24" height="24">
                      {% endif %}
                    {% when 'S2' %}
                      {% if settings.icon_burglary_s2 != blank %}
                        <img src="{{ settings.icon_burglary_s2 | image_url: width: 48 }}" alt="S2 Grade" width="24" height="24">
                      {% endif %}
                    {% when 'Grade 0' %}
                      {% if settings.icon_burglary_grade_0 != blank %}
                        <img src="{{ settings.icon_burglary_grade_0 | image_url: width: 48 }}" alt="Grade 0" width="24" height="24">
                      {% endif %}
                    {% when 'Grade I' %}
                      {% if settings.icon_burglary_grade_1 != blank %}
                        <img src="{{ settings.icon_burglary_grade_1 | image_url: width: 48 }}" alt="Grade I" width="24" height="24">
                      {% endif %}
                    {% when 'Grade II' or 'GRADE II' %}
                      {% if settings.icon_burglary_grade_2 != blank %}
                        <img src="{{ settings.icon_burglary_grade_2 | image_url: width: 48 }}" alt="Grade II" width="24" height="24">
                      {% endif %}
                    {% when 'Grade III' or 'GRADE III' %}
                      {% if settings.icon_burglary_grade_3 != blank %}
                        <img src="{{ settings.icon_burglary_grade_3 | image_url: width: 48 }}" alt="Grade III" width="24" height="24">
                      {% endif %}
                    {% when 'Grade IV' or 'GRADE IV' %}
                      {% if settings.icon_burglary_grade_4 != blank %}
                        <img src="{{ settings.icon_burglary_grade_4 | image_url: width: 48 }}" alt="Grade IV" width="24" height="24">
                      {% endif %}
                    {% when 'Grade V' or 'GRADE V' %}
                      {% if settings.icon_burglary_grade_5 != blank %}
                        <img src="{{ settings.icon_burglary_grade_5 | image_url: width: 48 }}" alt="Grade V" width="24" height="24">
                      {% endif %}
                  {% endcase %}
                </div>
                <div class="feature-item__content">
                  <h3 class="feature-item__title">Certified Burglary Resistance</h3>
                  <div class="feature-item__text">
                    {% case burglary_grade %}
                      {% when 'S1' %}
                        {{ settings.icon_burglary_s1_description | default: 'Tested according to European standard EN-1143-1. S1 certified.' }}
                      {% when 'S2' %}
                        {{ settings.icon_burglary_s2_description | default: 'Tested according to European standard EN-1143-1. S2 certified.' }}
                      {% when 'Grade 0' %}
                        {{ settings.icon_burglary_grade_0_description | default: 'Tested according to European standard EN-1143-1. Grade 0 certified.' }}
                      {% when 'Grade I' %}
                        {{ settings.icon_burglary_grade_1_description | default: 'Tested according to European standard EN-1143-1. Grade I certified.' }}
                      {% when 'Grade II' or 'GRADE II' %}
                        {{ settings.icon_burglary_grade_2_description | default: 'Tested according to European standard EN-1143-1. Grade II certified.' }}
                      {% when 'Grade III' or 'GRADE III' %}
                        {{ settings.icon_burglary_grade_3_description | default: 'Tested according to European standard EN-1143-1. Grade III certified.' }}
                      {% when 'Grade IV' or 'GRADE IV' %}
                        {{ settings.icon_burglary_grade_4_description | default: 'Tested according to European standard EN-1143-1. Grade IV certified.' }}
                      {% when 'Grade V' or 'GRADE V' %}
                        {{ settings.icon_burglary_grade_5_description | default: 'Tested according to European standard EN-1143-1. Grade V certified.' }}
                      {% else %}
                        <p>{{ section.settings.burglary_description | default: 'Tested according to European standard EN-1143-1.' }} <strong>{{ burglary_grade }}</strong> certified.</p>
                    {% endcase %}
                  </div>
                </div>
              </div>
            {% endif %}
  
            {% comment %} Auto-generated Fire Resistance feature {% endcomment %}
            {% if fire_resistance != blank %}
              <div class="feature-item feature-item--auto">
                <div class="feature-item__icon">
                  {% case fire_resistance %}
                    {% when '30 Minutes' %}
                      {% if settings.icon_fire_30_minutes != blank %}
                        <img src="{{ settings.icon_fire_30_minutes | image_url: width: 48 }}" alt="30 Minutes Fire Protection" width="24" height="24">
                      {% endif %}
                    {% when '60 Minutes' %}
                      {% if settings.icon_fire_60_minutes != blank %}
                        <img src="{{ settings.icon_fire_60_minutes | image_url: width: 48 }}" alt="60 Minutes Fire Protection" width="24" height="24">
                      {% endif %}
                    {% when '90 Minutes' %}
                      {% if settings.icon_fire_90_minutes != blank %}
                        <img src="{{ settings.icon_fire_90_minutes | image_url: width: 48 }}" alt="90 Minutes Fire Protection" width="24" height="24">
                      {% endif %}
                    {% when '120 Minutes' %}
                      {% if settings.icon_fire_120_minutes != blank %}
                        <img src="{{ settings.icon_fire_120_minutes | image_url: width: 48 }}" alt="120 Minutes Fire Protection" width="24" height="24">
                      {% endif %}
                    {% when 'Fire Insulated' %}
                      {% if settings.icon_fire_insulated != blank %}
                        <img src="{{ settings.icon_fire_insulated | image_url: width: 48 }}" alt="Fire Insulated" width="24" height="24">
                      {% endif %}
                  {% endcase %}
                </div>
                <div class="feature-item__content">
                  <h3 class="feature-item__title">Certified Fire Protection</h3>
                  <div class="feature-item__text">
                    {% case fire_resistance %}
                      {% when '30 Minutes' %}
                        {{ settings.icon_fire_30_minutes_description | default: 'Tested according to European Standards. 30 Minutes fire protection certified.' }}
                      {% when '60 Minutes' %}
                        {{ settings.icon_fire_60_minutes_description | default: 'Tested according to European Standards. 60 Minutes fire protection certified.' }}
                      {% when '90 Minutes' %}
                        {{ settings.icon_fire_90_minutes_description | default: 'Tested according to European Standards. 90 Minutes fire protection certified.' }}
                      {% when '120 Minutes' %}
                        {{ settings.icon_fire_120_minutes_description | default: 'Tested according to European Standards. 120 Minutes fire protection certified.' }}
                      {% when 'Fire Insulated' %}
                        {{ settings.icon_fire_insulated_description | default: 'Tested according to European Standards. Fire Insulated protection certified.' }}
                      {% else %}
                        <p>{{ section.settings.fire_description | default: 'Tested according to European Standards.' }} <strong>{{ fire_resistance }}</strong> protection.</p>
                    {% endcase %}
                  </div>
                </div>
              </div>
            {% endif %}
  
            {% comment %} Manual feature items from blocks {% endcomment %}
            {% for block in section.blocks %}
              {% case block.type %}
                {% when 'feature_item' %}
                  <div class="feature-item" {{ block.shopify_attributes }}>
                    <div class="feature-item__icon">
                      {% if block.settings.icon_image != blank %}
                        <img src="{{ block.settings.icon_image | image_url: width: 48 }}" 
                             alt="{{ block.settings.title | escape }}"
                             width="24" 
                             height="24">
                      {% elsif block.settings.icon != blank %}
                        {{ block.settings.icon }}
                      {% endif %}
                    </div>
                    <div class="feature-item__content">
                      {% if block.settings.title != blank %}
                        <h3 class="feature-item__title">{{ block.settings.title | escape }}</h3>
                      {% endif %}
                      {% if block.settings.text != blank %}
                        <div class="feature-item__text">{{ block.settings.text }}</div>
                      {% endif %}
                    </div>
                  </div>
              {% endcase %}
            {% endfor %}
          </div>
        {% endif %}
  
        {% if show_more_text != blank and hidden_text != blank %}
          <div class="collection-header__expandable">
            <button type="button" class="collection-header__show-more" aria-expanded="false">
              <span class="show-more-text">{{ show_more_text | escape }}</span>
              <span class="show-less-text" style="display: none;">{{ section.settings.show_less_text | default: 'Show Less' | escape }}</span>
              <svg class="icon icon--chevron" viewBox="0 0 16 16" aria-hidden="true">
                <path d="M4 6l4 4 4-4H4z"/>
              </svg>
            </button>
            <div class="collection-header__hidden-content" style="display: none;">
              {{ hidden_text }}
            </div>
          </div>
        {% endif %}
      </header>
    </div>
  </section>
  
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const showMoreBtn = document.querySelector('.collection-header__show-more');
    const hiddenContent = document.querySelector('.collection-header__hidden-content');
    const showMoreText = document.querySelector('.show-more-text');
    const showLessText = document.querySelector('.show-less-text');
  
    if (showMoreBtn && hiddenContent) {
      showMoreBtn.addEventListener('click', function() {
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        
        if (isExpanded) {
          hiddenContent.style.display = 'none';
          showMoreText.style.display = 'inline';
          showLessText.style.display = 'none';
          this.setAttribute('aria-expanded', 'false');
          this.classList.remove('expanded');
        } else {
          hiddenContent.style.display = 'block';
          showMoreText.style.display = 'none';
          showLessText.style.display = 'inline';
          this.setAttribute('aria-expanded', 'true');
          this.classList.add('expanded');
        }
      });
    }
  });
  </script>
  
  {% schema %}
  {
    "name": "Collection Header",
    "tag": "section",
    "class": "section",
    "settings": [
      {
        "type": "text",
        "id": "title",
        "label": "Fallback Title",
        "default": "Keep Your Valuables Secure with the Perfect Safe!",
        "info": "Used only if collection has no title"
      },
      {
        "type": "richtext",
        "id": "description",
        "label": "Fallback Description",
        "default": "<p>A safe helps prevent unauthorized access to your valuables. SafeGear offers high-quality safes in security levels according to European Norm EN-1143-1. Ideal for storing documents, jewelry and cash at home or in a business.</p>",
        "info": "Used only if collection has no description"
      },
      {
        "type": "header",
        "content": "Show More Section"
      },
      {
        "type": "text",
        "id": "show_more_text",
        "label": "Show More Button Text",
        "default": "Click here for more..."
      },
      {
        "type": "text",
        "id": "show_less_text",
        "label": "Show Less Button Text",
        "default": "Show Less"
      },
      {
        "type": "richtext",
        "id": "hidden_text",
        "label": "Hidden Content",
        "info": "Content that will be shown when 'Show More' is clicked"
      }
    ],
    "blocks": [
      {
        "type": "feature_item",
        "name": "Feature Item",
        "settings": [
          {
            "type": "image_picker",
            "id": "icon_image",
            "label": "Icon Image"
          },
          {
            "type": "html",
            "id": "icon",
            "label": "Icon SVG Code",
            "info": "Add your SVG icon code here (used if no image selected)"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Feature Title",
            "default": "Certified Burglary Resistance"
          },
          {
            "type": "richtext",
            "id": "text",
            "label": "Feature Text",
            "default": "<p>Tested according to European standard EN-1143-1. Security levels increase from S1, S2, Grade 0, Grade I, Grade II, Grade III, Grade IV and upwards. The blue icons indicate the burglary certification.</p>"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Collection Header",
        "blocks": [
          {
            "type": "feature_item",
            "settings": {
              "title": "Certified Burglary Resistance",
              "text": "<p>Tested according to European standard EN-1143-1. Security levels increase from S1, S2, Grade 0, Grade I, Grade II, Grade III, Grade IV and upwards. The blue icons indicate the burglary certification.</p>"
            }
          },
          {
            "type": "feature_item",
            "settings": {
              "title": "Certified Fire Protection",
              "text": "<p>Tested according to European Standards. Safes can have certified fire protection for 30 min, 60 min, 90 min. or 120 min. The red icons indicate fire certification.</p>"
            }
          }
        ]
      }
    ]
  }
  {% endschema %}