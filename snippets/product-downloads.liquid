{% comment %}
  Renders product downloads/user manuals section

  Accepts:
  - product: {Object} Product object

  Usage:
  {% render 'product-downloads', product: product %}
{% endcomment %}

{% liquid
  assign user_manuals = product.metafields.custom.user_manuals.value
%}

{%- if user_manuals != blank -%}
  {%- comment -%}
    Compute a safe label: the t filter returns a "translation missing: ..." string
    when the key is not defined, which is not blank â€” therefore the previous
    use of `| t | default: 'Downloads'` didn't work. Detect that string and
    fallback to 'Downloads'.
  {%- endcomment -%}
  {% assign downloads_label_raw = 'products.downloads.title' | t %}
  {% if downloads_label_raw contains 'translation missing' %}
    {% assign downloads_label = 'Downloads' %}
  {% else %}
    {% assign downloads_label = downloads_label_raw %}
  {% endif %}

  <div class="product-downloads">
    <h3 class="product-downloads__heading">{{ downloads_label }}</h3>
    <ul class="product-downloads__list">
      {% for file in user_manuals %}
        <li class="product-downloads__item">
          <a href="{{ file.url }}" class="product-downloads__link" download target="_blank" rel="noopener noreferrer">
            {% render 'icon-file', class: 'product-downloads__icon', size: 24, fill: '#E53E3E', stroke: 'currentColor', title: file.alt | default: 'User manual', aria_hidden: true %}
            <span class="product-downloads__text">
              {{ file.alt | default: 'User manual' }}
            </span>
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>
{% endif %}
